{% extends "layout.html" %}

{% block content %}
<div class="space-y-8">
  <!-- Header Section -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white mb-2">Ticket Details</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">{{ ticket.title }}</p>
    </div>
    <div class="mt-4 sm:mt-0">
      <a href="/tickets" class="inline-flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        Back to Tickets
      </a>
    </div>
  </div>

  <!-- Ticket Information -->
  <div class="bg-white/90 dark:bg-gray-900/90 p-6 rounded-2xl shadow-xl backdrop-blur border border-gray-200 dark:border-gray-700">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div>
        <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Priority</h3>
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold
          {% if ticket.priority == 'high' %}
            bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200
          {% elif ticket.priority == 'medium' %}
            bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200
          {% else %}
            bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
          {% endif %}">
          <span class="w-2 h-2 rounded-full mr-2
            {% if ticket.priority == 'high' %}bg-red-500
            {% elif ticket.priority == 'medium' %}bg-yellow-500
            {% else %}bg-green-500{% endif %}"></span>
        {{ ticket.priority|capitalize }}
      </span>
      </div>
      
      <div>
        <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Status</h3>
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold
          {% if ticket.status == 'resolved' %}
            bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
          {% elif ticket.status == 'pending' %}
            bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200
          {% else %}
            bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
          {% endif %}">
          <span class="w-2 h-2 rounded-full mr-2
            {% if ticket.status == 'resolved' %}bg-green-500
            {% elif ticket.status == 'pending' %}bg-yellow-500
            {% else %}bg-blue-500{% endif %}"></span>
          {{ ticket.status|capitalize }}
        </span>
      </div>
      
      <div>
        <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Created</h3>
        <p class="text-gray-900 dark:text-white font-medium">{{ ticket.date }}</p>
      </div>
    </div>
  </div>

  <!-- Ticket Description -->
  {% if ticket.description %}
    <div class="bg-white/90 dark:bg-gray-900/90 p-6 rounded-2xl shadow-xl backdrop-blur border border-gray-200 dark:border-gray-700">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Description
      </h2>
      <p class="text-gray-700 dark:text-gray-300 leading-relaxed">{{ ticket.description }}</p>
    </div>
  {% endif %}

  <!-- Comments Section -->
  <section class="bg-white/90 dark:bg-gray-900/90 p-6 rounded-2xl shadow-xl backdrop-blur border border-gray-200 dark:border-gray-700">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
      <svg class="w-6 h-6 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      Comments
    </h2>
    
    {% if comments %}
      <div class="space-y-4">
        {% for comment in comments %}
          <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700">
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center">
                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white font-semibold text-sm mr-3">
                  {{ comment.author[0]|upper }}
                </div>
                <div>
                  <p class="font-semibold text-gray-900 dark:text-white">{{ comment.author }}</p>
                  <p class="text-sm text-gray-500 dark:text-gray-400">{{ comment.timestamp }}</p>
                </div>
              </div>
            </div>
            <p class="text-gray-700 dark:text-gray-300 leading-relaxed">{{ comment.message }}</p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-8">
        <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
        <p class="text-gray-500 dark:text-gray-400">No comments yet. Be the first to add one!</p>
      </div>
    {% endif %}
  </section>

  <!-- Add Comment Form -->
  <section class="bg-white/90 dark:bg-gray-900/90 p-6 rounded-2xl shadow-xl backdrop-blur border border-gray-200 dark:border-gray-700">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
      <svg class="w-6 h-6 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
      </svg>
      Add a Comment
    </h2>
    
    <form method="POST" action="/ticket/{{ ticket.id }}/comment" class="space-y-4" id="comment-form">
      <div>
        <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Your Comment</label>
        <textarea name="message" id="message" rows="4" required 
          class="w-full p-4 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white rounded-xl border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary resize-none"
          placeholder="Share your thoughts or ask a question..."></textarea>
      </div>
      <button type="submit" id="comment-btn"
        class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary to-accent text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
        <span id="comment-btn-text">Post Comment</span>
        <svg id="comment-spinner" class="w-5 h-5 ml-2 animate-spin hidden" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
        </svg>
      </button>
  </form>
  </section>
</div>

<script>
  // Show spinner on comment submit
  document.getElementById('comment-form').addEventListener('submit', function() {
    document.getElementById('comment-btn-text').classList.add('hidden');
    document.getElementById('comment-spinner').classList.remove('hidden');
  });
</script>
{% endblock %}
